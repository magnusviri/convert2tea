- language: ruby
  install:
    - homebrew/bundle
    - cmake: 3
    - mecab: '*'
    - mecab-ipadic: '*'
    - msgpack: '*'
    - openssl@1.1: '*'
    - pcre: '*'
  script:
   - cmake .. <br>
         -DCMAKE_INSTALL_PREFIX="{{prefix}}" <br>
         -DBUILD_SHARED_LIBS=ON <br>
         -DENABLE_BUNDLED_MECAB=ON <br>
         -DENABLE_BUNDLED_MSGPACK=ON <br>
         -DENABLE_BUNDLED_ZLIB=ON <br>
         -DENABLE_LIBEDIT_BINDINGS=ON <br>
         -DENABLE_LUA_BINDINGS=OFF <br>
         -DENABLE_MRUBY_BINDINGS=ON <br>
         -DENABLE_PYTHON_BINDINGS=OFF <br>
         -DENABLE_RUBY_BINDINGS=OFF <br>
         -DENABLE_STATIC_EXECUTABLES=OFF <br>
         -DENABLE_ZLIB=ON <br>
         -DMSGPACK_INCLUDE_DIR="{{msgpack_include}}" <br>
         -DMSGPACK_LIBRARY="{{msgpack_lib_dir}}/libmsgpack.dylib" <br>
         -DPACKAGE_DOWNLOAD_ARGUMENTS="-O groonga.tar.gz" <br>
         -DWITH_BUNDLED_MECAB=yes <br>
         -DWITH_BUNDLED_MSGPACK=yes <br>
         -DWITH_BUNDLED_ZLIB=yes <br>
         -DWITH_MECABCONFIG_EXE=/usr/local/bin/mecab-config <br>
         -DWITH_OUT_PREFIX=yes <br>
         -DZLIB_INCLUDE_DIR="{{pcre_include_dir}}" <br>
         -DZLIB_LIBRARY="{{pcre_lib_dir}}/libpcre.dylib" <br>
   - make
   - make install
  env:
    prefix: "{{ groonga_prefix }}"
    msgpack_include: "{{msgpack}}/include"
    msgpack_lib_dir: "{{msgpack}}/lib"
    pcre_include_dir: "{{pcre}}/include"
    pcre_lib_dir: "{{pcre}}/lib"
  test:
    fixture: |
      table_create --name TestTable --flags TABLE_HASH_KEY --key_type ShortText
      shutdown
    script: |
      groonga -n "{{testpath}}"/test.db < $FIXTURE
      groonga -n "{{testpath}}"/test-normalizer-mysql.db < $FIXTURE