distributable:
  url: https://packages.groonga.org/source/groonga/groonga-{{ version }}.tar.gz

versions:
  github: groonga/groonga
  strip: /^groonga-/

provides:
  - bin/groonga
  - bin/groonga-ablog
  - bin/groonga-httpd
  - bin/groonga-normalizer-mysql
  - bin/groonga-suggest-create-dictionary
  - bin/groonga-suggest-server

dependencies:
  mecab.github.io: '*'
  mecab.github.io: ipadic
  msgpack.org: '^3.2'
  openssl.org: '^1.1'
  pcre.org: '^8.40'

build:
  dependencies:
    tea.xyz/gx/cc: c99
    tea.xyz/gx/make: '*'
    freedesktop.org/pkg-config: '*'
    groonga.org/mruby: '^3.0.0'
    groonga.org/libevent: '^2.1.12'
    groonga.org/zlib: '*'
  script: |
    ./configure $ARGS
    make --jobs {{hw.concurrency}}
    make install
  env:
    ARGS:
      - --prefix="{{prefix}}"
      - --disable-zeromq
      - --disable-apache-arrow
      - --with-luajit=no
      - --with-ssl
      - --with-zlib
      - --without-libstemmer
      - --with-mecab
      - --with-msgpack="{{brew_prefix}}/opt/msgpack"

test: |
  groonga -n test.db <<-EOS
    table_create --name TestTable --flags TABLE_HASH_KEY --key_type ShortText
    shutdown
  EOS
  groonga -n test-normalizer-mysql.db <<-EOS
    register normalizers/mysql
    shutdown
  EOS